name: Deploy MkDocs site via SFTP
on:
  push:
    branches:
      - master
      - main
permissions:
  contents: write
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          sparse-checkout: |
            docs
            includes
      - uses: actions/setup-python@v4
        with:
          python-version: 3.x
      - run: pip install mkdocs-material
      - run: mkdocs gh-deploy --force
      - run: pip install mkdocs-material 
      - run: pip install mkdocs-git-revision-date-localized-plugin
      - run: pip install mkdocs-git-authors-plugin
      - run: pip install mkdocs-awesome-nav

      - run: mkdocs gh-deploy --force

      # - name: Install lftp
      #   run: sudo apt-get update && sudo apt-get install -y lftp

      # - name: Upload gh-pages over FTP
      #   env:
      #     FTP_HOST: ${{ secrets.FTP_HOST }}
      #     FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
      #     FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
      #     REMOTE_PATH: "/"
      #   run:
      #     lftp -u "$FTP_USERNAME","$FTP_PASSWORD" "$FTP_HOST" -e "mirror -R --delete --verbose -x .git* -x .github . $REMOTE_PATH; quit"

      - name: Deploy files via SFTP
        uses: pressidium/lftp-mirror-action@v1
        with:
          # SFTP credentials
          host: ${{ secrets.FTP_HOST }}
          port: 22
          user: ${{ secrets.FTP_USERNAME }}
          pass: ${{ secrets.FTP_PASSWORD }}
          # lftp settings
          onlyNewer: true
          settings: 'sftp:auto-confirm=yes'
          # Mirror command options
          localDir: '.'
          remoteDir: '.'
          reverse: true
          ignoreFile: '.lftp_ignore'
          options: '--verbose'
